System.register(["../../@pfelements/pfelement.js","./rhdp-search-result.js"],function(t,e){"use strict";var o,s,i,r,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(t,e)},function(t,e){function s(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});e&&e.id;return{setters:[function(t){s=t},function(t){i=t}],execute:function(){r=function(e){function t(){var t=e.call(this,"rhdp-search-results")||this;return t.template=function(t){var e=document.createElement("template");return e.innerHTML="\n        <style>\n            \n        </style>\n        "+(t.invalid?'\n        <div class="invalidMsg">\n        <h4>Well, this is awkward. No search term was entered yet, so this page is a little empty right now.</h4>\n        <p>After you enter a search term in the box above, you will see the results displayed here. \n        You can also use the filters to select a content type, product or topic to see some results too. \n        Try it out!</p>\n        </div>':""),e},t._more=!1,t._last=0,t._valid=!0,t.invalidMsg=document.createElement("div"),t.loadMore=document.createElement("div"),t.endOfResults=document.createElement("div"),t.loading=document.createElement("div"),t._renderResults=t._renderResults.bind(t),t._setLoading=t._setLoading.bind(t),t._checkValid=t._checkValid.bind(t),t._clearResults=t._clearResults.bind(t),t}return n(t,e),Object.defineProperty(t.prototype,"results",{get:function(){return this._results},set:function(t){this._results!==t&&(this._results=t,this._renderResults(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"more",{get:function(){return this._more},set:function(t){this._more!==t&&(this._more=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this._last},set:function(t){this._last!==t&&(this._last=t||0,this.setAttribute("last",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){return this._valid},set:function(t){this._valid!==t&&(this._valid=t)},enumerable:!0,configurable:!0}),t.prototype.connectedCallback=function(){var s=this;e.prototype.render.call(this,this.template(this)),this.setAttribute("data-rhd-col","5span9"),this.endOfResults.innerHTML='<p class="end-of-results">- End of Results -</p>',this.loadMore.className="moreBtn",this.loadMore.innerHTML='<a class="moreBtn" href="#">Load More</a>',this.loading.className="loading",this.loadMore.addEventListener("click",function(t){t.preventDefault();var e={detail:{from:s.last},bubbles:!0,composed:!0};s.dispatchEvent(new CustomEvent("load-more",e))}),top.addEventListener("search-complete",this._renderResults),top.addEventListener("search-start",this._setLoading),top.addEventListener("params-ready",this._checkValid),top.window.addEventListener("popstate",this._clearResults),this.shadowRoot.addEventListener("load-more",function(t){s.more=!0})},t.prototype.addResult=function(t){var e=new i.default;e.result=t,this.shadowRoot.appendChild(e)},t.prototype._setLoading=function(t){if(this.more)this.shadowRoot.querySelector(".moreBtn")&&this.shadowRoot.removeChild(this.loadMore),this.shadowRoot.querySelector(".invalidMsg")&&this.shadowRoot.removeChild(this.invalidMsg),this.more=!1;else for(;this.shadowRoot.firstChild;)this.shadowRoot.removeChild(this.shadowRoot.firstChild);this.shadowRoot.appendChild(this.loading)},t.prototype._renderResults=function(t){if(this.shadowRoot.querySelector(".loading")&&this.shadowRoot.removeChild(this.loading),t.detail&&void 0!==t.detail.results&&void 0===t.detail.invalid)this.addResults(t.detail.results);else{for(;this.shadowRoot.firstChild;)this.shadowRoot.removeChild(this.shadowRoot.firstChild);this.shadowRoot.appendChild(this.invalidMsg)}var e={detail:{results:this.results},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("results-loaded",e))},t.prototype._clearResults=function(t){this.results=void 0},t.prototype._checkValid=function(t){var e=t.detail;this.valid=0<Object.keys(e.filters).length||null!==e.term&&""!==e.term&&void 0!==e.term,this.valid?this.shadowRoot.querySelector(".invalidMsg")&&this.shadowRoot.removeChild(this.invalidMsg):this.shadowRoot.appendChild(this.invalidMsg)},t.prototype.addResults=function(t){if(t&&t.hits&&t.hits.hits){for(var e=t.hits.hits,s=e.length,o=0;o<s;o++)this.addResult(e[o]);this.last=this.last+s,this.last>=t.hits.total&&this.shadowRoot.appendChild(this.endOfResults),0<s&&this.last<t.hits.total?(this.shadowRoot.querySelector(".end-of-results")&&this.shadowRoot.removeChild(this.endOfResults),this.shadowRoot.appendChild(this.loadMore)):(this.shadowRoot.querySelector(".moreBtn")&&this.shadowRoot.removeChild(this.loadMore),this.shadowRoot.appendChild(this.endOfResults))}},t}(s.default),t("default",r),customElements.define("rhdp-search-results",r)}}});