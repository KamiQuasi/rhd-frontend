System.register([],function(t,e){"use strict";var i,r,s=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});e&&e.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t._limit=10,t._from=0,t._sort="relevance",t._valid=!0,t.urlTemplate=function(t,e,r,i,s,n,o,a,l){var c="";return"most-recent"===n&&(c="&newFirst=true"),e+"?tags_or_logic=true&filter_out_excluded=true&from="+i+c+"&query="+r+"&query_highlight=true&size"+s+"=true"+o+a+l},t._changeAttr=t._changeAttr.bind(t),t}return s(t,e),Object.defineProperty(t.prototype,"filters",{get:function(){return this._filters},set:function(t){this._filters!==t&&(this._filters=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeFilters",{get:function(){return this._activeFilters},set:function(t){this._activeFilters!==t&&(this._activeFilters=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"from",{get:function(){return this._from},set:function(t){this._from!==t&&(this._from=t,this.setAttribute("from",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit!==t&&(this._limit=t,this.setAttribute("limit",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sort",{get:function(){return this._sort},set:function(t){this._sort!==t&&(this._sort=t,this.setAttribute("sort",t))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"results",{get:function(){return this._results},set:function(t){this._results!==t&&(this._results=t,this.from=this.results&&this.results.hits&&void 0!==this.results.hits.hits?this.from+this.results.hits.hits.length:0,this.dispatchEvent(new CustomEvent("search-complete",{detail:{term:this.term,filters:this.activeFilters,sort:this.sort,limit:this.limit,from:this.from,results:this.results},bubbles:!0})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"term",{get:function(){return this._term},set:function(t){this._term!==t&&(this._term=t,this.setAttribute("term",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},set:function(t){this._url!==t&&(this._url=t,this.setAttribute("url",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){return this._valid},set:function(t){this._valid!==t&&(this._valid=t)},enumerable:!0,configurable:!0}),t.prototype.filterString=function(t){for(var e=t.length,r=[],i=0;i<e;i++)for(var s=0;s<t[i].items.length;s++)if(t[i].items[s].active)for(var n=0;n<t[i].items[s].value.length;)r.push(t[i].items[s].value[n]),n+=1;return r.join(", ")},t.prototype.connectedCallback=function(){top.addEventListener("params-ready",this._changeAttr),top.addEventListener("term-change",this._changeAttr),top.addEventListener("filter-item-change",this._changeAttr),top.addEventListener("sort-change",this._changeAttr),top.addEventListener("clear-filters",this._changeAttr),top.addEventListener("load-more",this._changeAttr)},Object.defineProperty(t,"observedAttributes",{get:function(){return["term","sort","limit","results","url"]},enumerable:!0,configurable:!0}),t.prototype.attributeChangedCallback=function(t,e,r){this[t]=r},t.prototype._setFilters=function(r){var i=this;r.active?(this.activeFilters[r.group]=this.activeFilters[r.group]||[],this.activeFilters[r.group].push(r.key)):Object.keys(this.activeFilters).forEach(function(t){if(t===r.group){var e=i.activeFilters[t].indexOf(r.key);0<=e&&(i.activeFilters[t].splice(e,1),0===i.activeFilters[t].length&&delete i.activeFilters[t])}})},t.prototype._changeAttr=function(t){switch(t.type){case"term-change":t.detail&&t.detail.term&&0<t.detail.term.length?this.term=t.detail.term:this.term="",this.from=0,this.search();break;case"filter-item-change":t.detail&&t.detail.facet&&this._setFilters(t.detail.facet),this.from=0,this.search();break;case"sort-change":t.detail&&t.detail.sort&&(this.sort=t.detail.sort),this.from=0,this.search();break;case"load-more":this.search();break;case"clear-filters":this.activeFilters={},this.search();break;case"params-ready":t.detail&&t.detail.term&&(this.term=t.detail.term),t.detail&&t.detail.sort&&(this.sort=t.detail.sort),t.detail&&t.detail.filters&&(this.activeFilters=t.detail.filters),((this.from=0)<Object.keys(t.detail.filters).length||null!==t.detail.term||null!==t.detail.sort||null!==t.detail.qty)&&this.search()}},t.prototype.search=function(){var r=this;if(this.dispatchEvent(new CustomEvent("search-start",{bubbles:!0})),0<Object.keys(this.activeFilters).length||null!==this.term&&""!==this.term&&void 0!==this.term){var i=new URL(this.url);i.searchParams.set("tags_or_logic","true"),i.searchParams.set("filter_out_excluded","true"),i.searchParams.set("from",this.from.toString()),"most-recent"===this.sort&&i.searchParams.set("newFirst","true"),i.searchParams.set("query",this.term||""),i.searchParams.set("query_highlight","true"),i.searchParams.set("size"+this.limit.toString(),"true"),this.activeFilters&&Object.keys(this.activeFilters).forEach(function(t){r.filters.facets.forEach(function(e){e.key===t&&e.items.forEach(function(t){0<=r.activeFilters[e.key].indexOf(t.key)&&t.value.forEach(function(t){i.searchParams.append(e.key,t)})})})}),fetch(i.toString()).then(function(t){return t.json()}).then(function(t){r.results=t})}else this.dispatchEvent(new CustomEvent("search-complete",{detail:{invalid:!0},bubbles:!0}))},t}(HTMLElement),t("default",r),customElements.define("rhdp-search-query",r)}}});