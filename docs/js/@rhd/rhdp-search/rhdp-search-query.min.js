System.register(["../../@rhelements/rhelement/rhelement.js"],function(t,e){"use strict";var i,r,s,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});e&&e.id;return{setters:[function(t){r=t}],execute:function(){s=function(e){function r(){var t=e.call(this,r)||this;return t._filters={term:"",facets:{}},t._activeFilters={},t._limit=10,t._from=0,t._sort="relevance",t._valid=!0,t.urlTemplate=function(t,e,r,i,s,n,o,a,l){var c="";return"most-recent"===n&&(c="&newFirst=true"),e+"?tags_or_logic=true&filter_out_excluded=true&from="+i+c+"&query="+r+"&query_highlight=true&size"+s+"=true"+o+a+l},t._changeAttr=t._changeAttr.bind(t),t}return n(r,e),Object.defineProperty(r.prototype,"html",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(r,"tag",{get:function(){return"rhdp-search-query"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"filters",{get:function(){return this._filters},set:function(t){this._filters!==t&&(this._filters=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activeFilters",{get:function(){return this._activeFilters},set:function(t){this._activeFilters!==t&&(this._activeFilters=t,this.filters.facets=this._activeFilters)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"from",{get:function(){return this._from},set:function(t){this._from!==t&&(this._from=t,this.setAttribute("from",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit!==t&&(this._limit=t,this.setAttribute("limit",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sort",{get:function(){return this._sort},set:function(t){this._sort!==t&&(this._sort=t,this.setAttribute("sort",t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"results",{get:function(){return this._results},set:function(t){if(this._results!==t){this._results=t,this.from=this.results&&this.results.hits&&void 0!==this.results.hits.hits?this.from+this.results.hits.hits.length:0;var e={detail:{term:this.term,filters:this.activeFilters,sort:this.sort,limit:this.limit,from:this.from,results:this.results},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("search-complete",e))}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"term",{get:function(){return this._term},set:function(t){this._term!==t&&(this._term=t,this.filters.term=this._term,this.setAttribute("term",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"url",{get:function(){return this._url},set:function(t){this._url!==t&&(this._url=t,this.setAttribute("url",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"valid",{get:function(){return this._valid},set:function(t){this._valid!==t&&(this._valid=t)},enumerable:!0,configurable:!0}),r.prototype.filterString=function(t){for(var e=t.length,r=[],i=0;i<e;i++)for(var s=0;s<t[i].items.length;s++)if(t[i].items[s].active)for(var n=0;n<t[i].items[s].value.length;)r.push(t[i].items[s].value[n]),n+=1;return r.join(", ")},r.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),top.addEventListener("params-ready",this._changeAttr),top.addEventListener("term-change",this._changeAttr),top.addEventListener("filter-item-change",this._changeAttr),top.addEventListener("sort-change",this._changeAttr),top.addEventListener("clear-filters",this._changeAttr),top.addEventListener("load-more",this._changeAttr)},Object.defineProperty(r,"observedAttributes",{get:function(){return["term","sort","limit","results","url"]},enumerable:!0,configurable:!0}),r.prototype.attributeChangedCallback=function(t,e,r){this[t]=r},r.prototype._setFilters=function(r){var i=this;r.active?(this.activeFilters[r.group]=this.activeFilters[r.group]||[],this.activeFilters[r.group].push(r.key)):Object.keys(this.activeFilters).forEach(function(t){if(t===r.group){var e=i.activeFilters[t].indexOf(r.key);0<=e&&(i.activeFilters[t].splice(e,1),0===i.activeFilters[t].length&&delete i.activeFilters[t])}})},r.prototype._changeAttr=function(t){switch(t.type){case"term-change":t.detail&&t.detail.term&&0<t.detail.term.length?this.term=t.detail.term:this.term="",this.from=0,this.search();break;case"filter-item-change":t.detail&&t.detail.facet&&this._setFilters(t.detail.facet),this.from=0,this.search();break;case"sort-change":t.detail&&t.detail.sort&&(this.sort=t.detail.sort),this.from=0,this.search();break;case"load-more":this.search();break;case"clear-filters":this.activeFilters={},this.search();break;case"params-ready":t.detail&&t.detail.term&&(this.term=t.detail.term),t.detail&&t.detail.sort&&(this.sort=t.detail.sort),t.detail&&t.detail.filters&&(this.activeFilters=t.detail.filters),((this.from=0)<Object.keys(t.detail.filters).length||null!==t.detail.term||null!==t.detail.sort||null!==t.detail.qty)&&this.search()}},r.prototype.search=function(){var r=this;if(this.dispatchEvent(new CustomEvent("search-start",{bubbles:!0,composed:!0})),this.url&&(this.activeFilters&&0<Object.keys(this.activeFilters).length||null!==this.term&&""!==this.term&&void 0!==this.term)){var i=new URL(this.url);i.searchParams.set("tags_or_logic","true"),i.searchParams.set("filter_out_excluded","true"),i.searchParams.set("from",this.from.toString()),"most-recent"===this.sort&&i.searchParams.set("newFirst","true"),i.searchParams.set("query",this.term||""),i.searchParams.set("query_highlight","true"),i.searchParams.set("size"+this.limit.toString(),"true"),Object.keys(this.filters.facets).forEach(function(e){r.filters.facets[e].forEach(function(t){top.document.querySelector("rhdp-search-filter-item[group="+e+"][key="+t+"]").getAttribute("type").split(",").forEach(function(t){i.searchParams.append(e,t)})})}),fetch(i.toString()).then(function(t){return t.json()}).then(function(t){r.results=t})}else{this.dispatchEvent(new CustomEvent("search-complete",{detail:{invalid:!0},bubbles:!0,composed:!0}))}},r}(r.default),t("default",s),r.default.create(s)}}});