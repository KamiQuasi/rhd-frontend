System.register(["../../@patternfly/pfelement/pfelement.js"],function(t,e){"use strict";var i,r,s,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});e&&e.id;return{setters:[function(t){r=t}],execute:function(){s=function(e){function r(){var t=e.call(this,r)||this;return t._filters={term:"",facets:{}},t._activeFilters=new Map,t._limit=10,t._from=0,t._sort="relevance",t._valid=!0,t.urlTemplate=function(t,e,r,i,s,n,o,a,l){return"most-recent"===n&&"&newFirst=true",e+"?start="+i+"&q="+r+"&hl=true&hl.fl=description&rows="+s+"&"+o+"&"+a+"&"+l},t._changeAttr=t._changeAttr.bind(t),t}return n(r,e),Object.defineProperty(r.prototype,"html",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(r,"tag",{get:function(){return"dp-search-query"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"filters",{get:function(){return this._filters},set:function(t){this._filters!==t&&(this._filters=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activeFilters",{get:function(){return this._activeFilters},set:function(t){this._activeFilters!==t&&(this._activeFilters=t,this.filters.facets=this._activeFilters)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"from",{get:function(){return this._from},set:function(t){this._from!==t&&(this._from=t,this.setAttribute("from",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit!==t&&(this._limit=t,this.setAttribute("limit",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sort",{get:function(){return this._sort},set:function(t){this._sort!==t&&(this._sort=t,this.setAttribute("sort",t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"results",{get:function(){return this._results},set:function(t){if(this._results!==t){this._results=t,this.from=this.results&&this.results.response&&void 0!==this.results.response.docs?this.from+this.results.response.docs.length:0;var e={detail:{term:this.term,filters:this.activeFilters,facets:this.results.facet_counts||{},sort:this.sort,limit:this.limit,from:this.from,results:this.results.response},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("search-complete",e))}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"term",{get:function(){return this._term},set:function(t){this._term!==t&&(this._term=t,this.filters.term=this._term,this.setAttribute("term",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"url",{get:function(){return this._url},set:function(t){this._url!==t&&(this._url=t,this.setAttribute("url",t.toString()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"valid",{get:function(){return this._valid},set:function(t){this._valid!==t&&(this._valid=t)},enumerable:!0,configurable:!0}),r.prototype.filterString=function(t){for(var e=t.length,r=[],i=0;i<e;i++)for(var s=0;s<t[i].items.length;s++)if(t[i].items[s].active)for(var n=0;n<t[i].items[s].value.length;)r.push(t[i].items[s].value[n]),n+=1;return r.join(", ")},r.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),top.addEventListener("params-ready",this._changeAttr),top.addEventListener("term-change",this._changeAttr),top.addEventListener("filter-item-change",this._changeAttr),top.addEventListener("sort-change",this._changeAttr),top.addEventListener("clear-filters",this._changeAttr),top.addEventListener("load-more",this._changeAttr)},Object.defineProperty(r,"observedAttributes",{get:function(){return["term","sort","limit","results","url"]},enumerable:!0,configurable:!0}),r.prototype.attributeChangedCallback=function(t,e,r){this[t]=r},r.prototype._setFilters=function(t){t.active?this.activeFilters.has(t.group)?this.activeFilters.get(t.group).add(t.key):this.activeFilters.set(t.group,new Set([t.key])):this.activeFilters.has(t.group)&&(this.activeFilters.get(t.group).delete(t.key),0===this.activeFilters.get(t.group).size&&this.activeFilters.delete(t.group))},r.prototype._changeAttr=function(t){switch(t.type){case"term-change":t.detail&&t.detail.term&&0<t.detail.term.length?this.term=t.detail.term:this.term="",this.from=0,this.search();break;case"filter-item-change":t.detail&&t.detail.facet&&this._setFilters(t.detail.facet),this.from=0,this.search();break;case"sort-change":t.detail&&t.detail.sort&&(this.sort=t.detail.sort),this.from=0,this.search();break;case"load-more":this.search();break;case"clear-filters":this.activeFilters.clear(),this.search();break;case"params-ready":t.detail&&t.detail.term&&(this.term=t.detail.term),t.detail&&t.detail.sort&&(this.sort=t.detail.sort),t.detail&&t.detail.filters&&(this.activeFilters=t.detail.filters),((this.from=0)<this.activeFilters.size||null!==t.detail.term||null!==t.detail.sort||null!==t.detail.qty)&&this.search()}},r.prototype.search=function(){var e=this;if(this.dispatchEvent(new CustomEvent("search-start",{bubbles:!0,composed:!0})),this.url&&(this.activeFilters&&0<this.activeFilters.size||null!==this.term&&""!==this.term&&void 0!==this.term)){var r=new URL(this.url);r.searchParams.set("start",this.from.toString()),r.searchParams.set("q",this.term||""),r.searchParams.set("hl","true"),r.searchParams.set("hl.fl","description"),r.searchParams.set("rows",this.limit.toString()),this.activeFilters.forEach(function(t,e){r.searchParams.set(e,Array.from(t).join(","))}),fetch(r.toString()).then(function(t){return t.json()}).then(function(t){e.results=t})}else{this.dispatchEvent(new CustomEvent("search-complete",{detail:{invalid:!0},bubbles:!0,composed:!0}))}},r}(r.default),t("default",s),r.default.create(s)}}});